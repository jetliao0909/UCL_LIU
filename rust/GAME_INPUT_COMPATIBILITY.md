# 遊戲輸入兼容性說明

## 貼上模式（剪貼簿 + Ctrl+V）的優勢

在遊戲環境中，**貼上模式確實具有最高的兼容性**，原因如下：

### 1. 模擬真實用戶操作

貼上模式（剪貼簿 + Ctrl+V）模擬的是真實用戶的操作流程：
1. 用戶複製文字到剪貼簿（正常操作）
2. 用戶按下 Ctrl+V 貼上（標準快捷鍵）

這種方式與真實用戶行為完全一致，不容易被反作弊系統檢測為異常。

### 2. 遊戲支援度高

大多數遊戲都支援 Ctrl+V 貼上功能：
- ✅ **MMORPG**：大多數都支援聊天框貼上
- ✅ **MOBA**：支援聊天輸入框貼上
- ✅ **FPS**：支援文字聊天貼上
- ✅ **策略遊戲**：支援文字輸入貼上
- ✅ **沙盒遊戲**：支援文字輸入貼上

### 3. 反作弊系統兼容性

- **較少檢測**：貼上操作是正常的用戶行為，反作弊系統通常不會攔截
- **不會觸發異常檢測**：不像直接 SendInput 可能被視為自動化工具
- **符合用戶習慣**：玩家經常使用 Ctrl+V 貼上，這是標準操作

### 4. 與直接輸入模式比較

| 特性 | 貼上模式 | 直接輸入模式 |
|------|---------|-------------|
| **兼容性** | ⭐⭐⭐⭐⭐ 最高 | ⭐⭐⭐ 中等 |
| **速度** | ⭐⭐⭐ 較慢（需要剪貼簿操作） | ⭐⭐⭐⭐⭐ 最快 |
| **反作弊檢測** | ⭐⭐⭐⭐⭐ 幾乎不會被檢測 | ⭐⭐ 可能被檢測 |
| **遊戲支援** | ⭐⭐⭐⭐⭐ 幾乎所有遊戲都支援 | ⭐⭐⭐ 部分遊戲可能不支援 |
| **剪貼簿影響** | ⚠️ 會覆蓋剪貼簿內容 | ✅ 不影響剪貼簿 |

## 當前實現

目前的實現使用貼上模式：

```rust
pub fn send_text_paste(&mut self, text: &str) -> Result<()> {
    // 1. 複製文字到剪貼簿
    let mut clipboard = Clipboard::new()?;
    clipboard.set_text(text)?;
    
    // 2. 等待剪貼簿更新
    thread::sleep(Duration::from_millis(10));
    
    // 3. 發送 Ctrl+V（使用 SendInput）
    // 按下 Ctrl -> 按下 V -> 釋放 V -> 釋放 Ctrl
}
```

## 遊戲輸入的特殊情況

### 1. 全螢幕遊戲

- ✅ **貼上模式**：通常可以正常工作
- ⚠️ **注意**：某些全螢幕遊戲可能會攔截 Ctrl+V，但這種情況較少見

### 2. 反作弊系統

常見的反作弊系統（如 BattlEye、EasyAntiCheat、Vanguard）：
- ✅ **貼上模式**：通常不會被檢測，因為是正常的用戶操作
- ⚠️ **直接輸入**：可能被檢測為自動化工具

### 3. 遊戲內聊天系統

大多數遊戲的聊天系統都支援：
- ✅ Ctrl+V 貼上
- ✅ Shift+Insert 貼上（部分遊戲）
- ✅ 右鍵貼上（部分遊戲）

## 已知限制

### 貼上模式的限制

1. **剪貼簿內容會被覆蓋**
   - 解決方案：可以考慮保存原始剪貼簿內容，使用後恢復（但會增加複雜度）

2. **速度較慢**
   - 需要剪貼簿操作 + 等待時間 + Ctrl+V 組合鍵
   - 但對於輸入法來說，這個速度通常可以接受

3. **某些遊戲可能禁用剪貼簿**
   - 極少數遊戲可能會禁用剪貼簿操作
   - 這種情況下，直接輸入模式也無法工作

### 直接輸入模式的限制

1. **可能被遊戲攔截**
   - 某些遊戲使用 DirectInput 或 Raw Input，可能不會接收 SendInput

2. **可能被反作弊系統檢測**
   - 某些反作弊系統會檢測異常的輸入模式

3. **Unicode 字符處理複雜**
   - 需要正確處理 Unicode 字符的輸入
   - 不同遊戲可能有不同的字符編碼要求

## 建議

### 對於遊戲輸入

1. **優先使用貼上模式**（當前實現）
   - 兼容性最高
   - 不容易被檢測
   - 支援度最好

2. **保留直接輸入模式作為備選**
   - 可以作為配置選項
   - 用於特殊情況或非遊戲環境

3. **考慮添加配置選項**
   - 讓用戶可以選擇輸入模式
   - 針對特定遊戲可以配置不同的模式

## 未來改進方向

1. **智能模式切換**
   - 檢測當前應用程式
   - 針對遊戲自動使用貼上模式
   - 針對普通應用程式可以使用直接輸入模式（更快）

2. **剪貼簿內容保護**
   - 保存原始剪貼簿內容
   - 使用後恢復（可選功能）

3. **多種貼上方式支援**
   - Ctrl+V（當前）
   - Shift+Insert（備選）
   - 右鍵貼上（如果可能）

## 參考資料

- [Windows SendInput API](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-sendinput)
- [遊戲輸入處理最佳實踐](https://docs.microsoft.com/en-us/windows/win32/inputdev/user-input)
- [反作弊系統檢測機制](https://www.battleye.com/)

